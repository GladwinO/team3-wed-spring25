{% extends 'base.html' %} 

{% block content %}
<h2 class="text-center">Post A Parking Spot</h2>

<form
  class="w-50 mx-auto"
  id="parkingForm"
  onsubmit="return validateForm(event)"
>
  {% csrf_token %}
  <div class="mb-3">
    <label for="title" class="form-label">Spot Title</label>
    <input
      type="text"
      class="form-control"
      id="title"
      name="title"
      required
      minlength="3"
      maxlength="100"
    />
    <div class="invalid-feedback">
      Title must be between 3 and 100 characters
    </div>
  </div>
  <div class="mb-3">
    <label for="address" class="form-label">Location Address</label>
    <input
      type="text"
      class="form-control"
      id="address"
      name="address"
      required
    />
    <div class="invalid-feedback">Please enter a valid address</div>
  </div>
  <div class="mb-3">
    <label for="price" class="form-label">Price per Hour ($)</label>
    <input
      type="number"
      class="form-control"
      id="price"
      name="price"
      required
      min="0.01"
      step="0.01"
    />
    <div class="invalid-feedback">Price must be greater than 0</div>
  </div>
  <div class="row mb-3">
    <div class="col">
      <label for="start_date" class="form-label">Available From</label>
      <input
        type="date"
        class="form-control"
        id="start_date"
        name="start_date"
        required
      />
      <div class="invalid-feedback">Start date cannot be in the past</div>
    </div>
    <div class="col">
      <label for="end_date" class="form-label">Available Until</label>
      <input
        type="date"
        class="form-control"
        id="end_date"
        name="end_date"
        required
      />
      <div class="invalid-feedback">End date must be after start date</div>
    </div>
  </div>
  <div class="row mb-3">
    <div class="col">
      <label for="start_time" class="form-label">Available Time From</label>
      <input
        type="time"
        class="form-control"
        id="start_time"
        name="start_time"
        required
      />
      <div class="invalid-feedback">Please enter a valid start time</div>
    </div>
    <div class="col">
      <label for="end_time" class="form-label">Available Time Until</label>
      <input
        type="time"
        class="form-control"
        id="end_time"
        name="end_time"
        required
      />
      <div class="invalid-feedback">End time must be after start time</div>
    </div>
  </div>
  <div class="mb-3">
    <label for="description" class="form-label">Description</label>
    <textarea
      class="form-control"
      id="description"
      name="description"
      rows="3"
      required
      minlength="10"
      maxlength="500"
    ></textarea>
    <div class="invalid-feedback">
      Description must be between 10 and 500 characters
    </div>
  </div>
  <button type="submit" class="btn btn-primary w-100">Post Spot</button>
</form>
{% endblock %} {% block scripts %}
<script>
  function validateForm(event) {
    event.preventDefault();

    // Reset all validations
    const form = document.getElementById("parkingForm");
    const inputs = form.querySelectorAll("input, select, textarea");
    inputs.forEach((input) => {
      input.classList.remove("is-invalid");
    });

    let isValid = true;

    // Validate title
    const title = document.getElementById("title");
    if (title.value.length < 3 || title.value.length > 100) {
      title.classList.add("is-invalid");
      isValid = false;
    }

    // Validate price
    const price = document.getElementById("price");
    if (price.value <= 0) {
      price.classList.add("is-invalid");
      isValid = false;
    }

    // Validate dates
    const startDate = new Date(document.getElementById("start_date").value);
    const endDate = new Date(document.getElementById("end_date").value);
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    if (startDate < today) {
      document.getElementById("start_date").classList.add("is-invalid");
      isValid = false;
    }

    if (endDate <= startDate) {
      document.getElementById("end_date").classList.add("is-invalid");
      isValid = false;
    }

    // Validate times
    const startTime = document.getElementById("start_time").value;
    const endTime = document.getElementById("end_time").value;
    if (startTime >= endTime) {
      document.getElementById("start_time").classList.add("is-invalid");
      document.getElementById("end_time").classList.add("is-invalid");
      isValid = false;
    }

    // Validate description
    const description = document.getElementById("description");
    if (description.value.length < 10 || description.value.length > 500) {
      description.classList.add("is-invalid");
      isValid = false;
    }

    // If all validations pass, submit the form
    if (isValid) {
      form.submit();
    }
  }

  // Set minimum date for date inputs
  const today = new Date().toISOString().split("T")[0];
  document.getElementById("start_date").min = today;
  document.getElementById("end_date").min = today;
</script>
{% endblock %}
